package com.grigorijtomczuk.dbuser.ui.fragment\n\nimport android.os.Bundle\nimport android.view.LayoutInflater\nimport android.view.View\nimport android.view.ViewGroup\nimport androidx.appcompat.app.AlertDialog\nimport androidx.fragment.app.Fragment\nimport androidx.lifecycle.ViewModelProvider\nimport androidx.navigation.fragment.findNavController\nimport androidx.recyclerview.widget.LinearLayoutManager\nimport com.grigorijtomczuk.dbuser.R\nimport com.grigorijtomczuk.dbuser.data.db.entity.Motorcycle\nimport com.grigorijtomczuk.dbuser.databinding.FragmentMotorcycleListBinding\nimport com.grigorijtomczuk.dbuser.ui.adapter.MotorcycleAdapter\nimport com.grigorijtomczuk.dbuser.ui.viewmodel.MotorcycleViewModel\n\nclass MotorcycleListFragment : Fragment() {\n\n    private var _binding: FragmentMotorcycleListBinding? = null\n    private val binding get() = _binding!!\n\n    private lateinit var motorcycleViewModel: MotorcycleViewModel\n\n    override fun onCreateView(\n        inflater: LayoutInflater,\n        container: ViewGroup?,\n        savedInstanceState: Bundle?\n    ): View {\n        _binding = FragmentMotorcycleListBinding.inflate(inflater, container, false)\n        return binding.root\n    }\n\n    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n        super.onViewCreated(view, savedInstanceState)\n\n        val adapter = MotorcycleAdapter { motorcycle ->\n            showOptionsDialog(motorcycle)\n        }\n        binding.recyclerView.adapter = adapter\n        binding.recyclerView.layoutManager = LinearLayoutManager(requireContext())\n\n        motorcycleViewModel = ViewModelProvider(this).get(MotorcycleViewModel::class.java)\n        motorcycleViewModel.allMotorcycles.observe(viewLifecycleOwner) {\ motorcycles ->\n            motorcycles?.let { adapter.setMotorcycles(it) }\n        }\n\n        binding.fabAdd.setOnClickListener {\n            findNavController().navigate(R.id.action_motorcycleListFragment_to_addMotorcycleFragment)\n        }\n\n        binding.fabDownload.setOnClickListener {\n            motorcycleViewModel.fetchAndSaveManufacturers()\n        }\n    }\n\n    private fun showOptionsDialog(motorcycle: Motorcycle) {\n        val options = arrayOf(\"Просмотр\", \"Удаление\", \"Обновление\")\n        AlertDialog.Builder(requireContext())\n            .setTitle(\"Выберите действие\")\n            .setItems(options) { _, which ->\n                when (which) {\n                    0 -> {\n                        val action = MotorcycleListFragmentDirections.actionMotorcycleListFragmentToMotorcycleDetailFragment(motorcycle.id)\n                        findNavController().navigate(action)\n                    }\n                    1 -> showDeleteConfirmationDialog(motorcycle)\n                    2 -> {\n                        val action = MotorcycleListFragmentDirections.actionMotorcycleListFragmentToUpdateMotorcycleFragment(motorcycle.id)\n                        findNavController().navigate(action)\n                    }\n                }\n            }\n            .show()\n    }\n\n    private fun showDeleteConfirmationDialog(motorcycle: Motorcycle) {\n        AlertDialog.Builder(requireContext())\n            .setTitle(\"Удалить мотоцикл\")\n            .setMessage(\"Вы уверены, что хотите удалить этот мотоцикл?\")\n            .setPositiveButton(\"Да\") { _, _ ->\n                motorcycleViewModel.delete(motorcycle)\n            }\n            .setNegativeButton(\"Нет\", null)\n            .show()\n    }\n\n    override fun onDestroyView() {\n        super.onDestroyView()\n        _binding = null\n    }\n}